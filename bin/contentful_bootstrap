#!/usr/bin/env ruby

require 'optparse'
require 'contentful_bootstrap/commands'

options = {}
global = OptionParser.new do |opts|
  opts.banner = "Usage: contentful_bootstrap <command> <space_name> [--template TEMPLATE_NAME]"
  opts.separator ""
  opts.separator <<-HELP
    Available commands are:
      init
      create_space
  HELP
end

subcommands = {
  'init' => OptionParser.new do |opts|
    opts.banner = "Usage: init <space_name> [--template TEMPLATE_NAME]"
    opts.on("-t", "--template TEMPLATE", "Specify Template", "blog, catalogue, gallery") do |t|
      options[:template] = t
    end
  end,
  'create_space' => OptionParser.new do |opts|
    opts.banner = "Usage: init <space_name> [--template TEMPLATE_NAME]"
    opts.on("-t", "--template TEMPLATE", "Specify Template", "blog, catalogue, gallery") do |t|
      options[:template] = t
    end
  end
}

global.order!
command = ARGV.shift
space_name = ARGV.shift

if subcommands.has_key? command
  subcommands[command].order!

  if space_name.nil? || space_name.empty?
    puts "Usage: contentful_bootstrap <command> <space_name> [--template TEMPLATE_NAME]"
    puts
    puts "You must provide a valid space name. Exiting!"
    exit
  end

  ContentfulBootstrap::Commands.new.send(command, space_name, options.fetch(:template, nil))
else
  puts "Usage: contentful_bootstrap <command> <space_name> [--template TEMPLATE_NAME]"
  puts
  puts <<-HELP
    Subcommand not available or missing
    Available commands are:
      init
      create_space
  HELP
end
